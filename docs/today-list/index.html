<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Today List Demo</title>
  <!-- Favicons (local to this demo) -->
  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="../design-system/tokens/colors.css">
  <link rel="stylesheet" href="../design-system/styles/flavors.css">
  <script type="module" src="../design-system/components/labs-icon.js"></script>
  <script type="module" src="../design-system/components/labs-button.js"></script>
  <!-- (Removed duplicate/conflicting theme management script. Only one script at end of file remains.) -->
  <style>
    body {
      background: var(--color-background, #f6f6f9);
      color: var(--color-on-background, #222);
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    main {
      width: 100%;
      max-width: 720px;
      margin: 40px auto 0 auto;
      padding: 0 16px;
      position: relative;
    }

    .today-theme-toggle {
      position: absolute;
      top: 0;
      right: 16px;
      z-index: 100;
    }

    /* Ensure archive icon and button are always visible */
    labs-button[aria-label="Archive"] {
      opacity: 1 !important;
      visibility: visible !important;
      pointer-events: auto !important;
    }

    labs-button[aria-label="Archive"] labs-icon[name="archive"] {
      color: var(--color-on-surface, #222) !important;
      opacity: 1 !important;
      visibility: visible !important;
      width: 24px;
      height: 24px;
      display: inline-block;
    }
  </style>
</head>

<body>

  <!-- Floating theme and flavor toggles (top right, outside main) -->
  <div id="floating-toggles"
    style="position:fixed;top:calc(20px + env(safe-area-inset-top));right:calc(20px + env(safe-area-inset-right));z-index:100;display:flex;flex-direction:column;gap:8px;">
    <labs-button id="themeToggle" class="pad-theme-toggle" variant="icon" aria-label="Toggle theme"
      style="height:48px;width:48px;min-width:48px;min-height:48px;padding:0;display:flex;align-items:center;justify-content:center;">
      <labs-icon id="themeIcon" slot="icon-left" name="bedtime" style="color:var(--color-on-surface);"
        class="pad-icon"></labs-icon>
    </labs-button>
    <labs-button id="flavorToggle" class="pad-flavor-toggle" variant="icon" aria-label="Switch flavor"
      title="Switch flavor"
      style="height:48px;width:48px;min-width:48px;min-height:48px;padding:0;display:flex;align-items:center;justify-content:center;">
      <labs-icon id="flavorIcon" slot="icon-left" name="colors" style="color:var(--color-on-surface);"
        class="pad-icon"></labs-icon>
    </labs-button>
  </div>

  <!-- Clear button (bottom-right, outside main container) -->
  <labs-button id="clearButton" class="pad-clear-button" variant="icon" aria-label="Clear all"
    style="height:48px;width:48px;min-width:48px;min-height:48px;padding:0;display:flex;align-items:center;justify-content:center;position:fixed;bottom:calc(20px + env(safe-area-inset-bottom));right:calc(20px + env(safe-area-inset-right));z-index:100;">
    <labs-icon slot="icon-left" name="delete_forever" style="color:var(--color-on-surface);"
      class="pad-icon"></labs-icon>
  </labs-button>

  <!-- External input and Add button for adding items -->
  <div id="external-add-wrap" style="display:flex;align-items:center;gap:8px;margin:32px 0 16px 0;">
    <labs-button id="externalAddBtn" variant="primary">
      <labs-icon slot="icon-left" name="add"></labs-icon>
      Add
    </labs-button>
    <input id="externalAddInput" type="text" placeholder="Add item and press Enter"
      style="flex:1;padding:10px 12px;border-radius:6px;border:1px solid #ccc;font-size:16px;display:none;" />
  </div>
  <today-list-app id="todayList" hide-header></today-list-app>
  </main>
  <labs-footer>
    <span slot="left">Â© 2025 Labs Design System</span>
    <div slot="right" style="display: flex; align-items: center; gap: 8px;">
      <span style="font-size: 0.9em; color: var(--color-on-surface-variant);">v2.1.5</span>
      <labs-button variant="icon" aria-label="Settings">
        <labs-icon name="settings" slot="icon-left"></labs-icon>
      </labs-button>
    </div>
  </labs-footer>
  <script type="module">
    import '../design-system/components/labs-input.js';
    import '../design-system/components/labs-card.js';
    import '../design-system/components/labs-toast.js';
    import '../design-system/components/today-list-app.js';
  </script>
  <script>
    // External add input/button toggle wiring
    const addInput = document.getElementById('externalAddInput');
    const addBtn = document.getElementById('externalAddBtn');
    const todayList = document.getElementById('todayList');
    function showInput() {
      addBtn.style.display = 'none';
      addInput.style.display = '';
      setTimeout(() => addInput.focus(), 10);
    }
    function hideInput() {
      addInput.style.display = 'none';
      addBtn.style.display = '';
    }
    function doAdd() {
      const value = addInput.value.trim();
      if (value && todayList && typeof todayList.addItem === 'function') {
        todayList.addItem(value);
        addInput.value = '';
        hideInput();
      }
    }
    addBtn.addEventListener('click', showInput);
    addInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') doAdd();
      if (e.key === 'Escape') hideInput();
    });
    addInput.addEventListener('blur', hideInput);
  </script>
  <script>
    // Theme management utilities (mirrored from Pad, but for Today List)
    function applyTheme({ flavor = 'blueberry', theme = 'light' } = {}) {
      const root = document.documentElement;
      root.classList.remove('flavor-vanilla', 'flavor-blueberry', 'flavor-strawberry');
      root.classList.add(`flavor-${flavor}`);
      root.classList.remove('theme-light', 'theme-dark');
      root.classList.add(`theme-${theme}`);
      root.setAttribute('data-color-scheme', theme);
      localStorage.setItem('today-list-theme', theme);
      localStorage.setItem('today-list-flavor', flavor);
      // Update meta theme-color for PWA
      const themeColorMeta = document.querySelector('meta[name="theme-color"]');
      const bgColor = getComputedStyle(root).getPropertyValue('--color-background').trim();
      if (themeColorMeta && bgColor) {
        themeColorMeta.setAttribute('content', bgColor);
      }
      document.dispatchEvent(new CustomEvent('themeChanged'));
    }

    function initSystemTheme(defaultTheme = 'light') {
      const savedTheme = localStorage.getItem('today-list-theme');
      const savedFlavor = localStorage.getItem('today-list-flavor');
      applyTheme({
        flavor: savedFlavor || 'blueberry',
        theme: savedTheme || 'light',
      });
    }

    function updateThemeToggleButton() {
      const themeIcon = document.getElementById('themeIcon');
      const themeButton = document.getElementById('themeToggle');
      const isDark = document.documentElement.classList.contains('theme-dark');
      if (themeIcon) {
        themeIcon.setAttribute('name', isDark ? 'bedtime_off' : 'bedtime');
      }
      if (themeButton) {
        themeButton.setAttribute('aria-label', isDark ? 'Switch to light mode' : 'Switch to dark mode');
      }
    }

    function toggleTheme() {
      const isDark = document.documentElement.classList.contains('theme-dark');
      const currentFlavor = getCurrentFlavor();
      applyTheme({ flavor: currentFlavor, theme: isDark ? 'light' : 'dark' });
      updateThemeToggleButton();
    }

    function getCurrentFlavor() {
      const flavors = ['vanilla', 'blueberry', 'strawberry'];
      for (const f of flavors) {
        if (document.documentElement.classList.contains(`flavor-${f}`)) return f;
      }
      return 'blueberry';
    }
    function cycleFlavor() {
      const flavors = ['vanilla', 'blueberry', 'strawberry'];
      const current = getCurrentFlavor();
      const idx = flavors.indexOf(current);
      const next = flavors[(idx + 1) % flavors.length];
      const isDark = document.documentElement.classList.contains('theme-dark');
      applyTheme({ flavor: next, theme: isDark ? 'dark' : 'light' });
    }

    // Initialize theme system
    initSystemTheme();

    document.addEventListener('DOMContentLoaded', () => {
      // Setup theme toggle button
      const themeToggle = document.getElementById('themeToggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
        updateThemeToggleButton();
      }
      // Setup flavor switcher button
      const flavorToggle = document.getElementById('flavorToggle');
      if (flavorToggle) {
        flavorToggle.addEventListener('click', cycleFlavor);
      }
      // Setup clear button
      const clearButton = document.getElementById('clearButton');
      if (clearButton) {
        clearButton.addEventListener('click', () => {
          // Find the today-list-app and call its reset method if available
          const app = document.getElementById('todayList');
          if (app && typeof app._resetAll === 'function') {
            app._resetAll();
          }
        });
      }
    });
  </script>
</body>

</html>
