<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Today List Footer Demo</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="../design-system/tokens/colors.css">
  <link rel="stylesheet" href="../design-system/styles/flavors.css">
  <script type="module" src="../design-system/components/labs-icon.js"></script>
  <script type="module" src="../design-system/components/labs-button.js"></script>
  <script type="module" src="../design-system/components/labs-footer.js"></script>
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      background: var(--color-background, #f6f6f9);
    }

    labs-footer {
      flex-shrink: 0;
      width: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    #footer-settings-btn labs-icon {
      width: 28px;
      height: 28px;
      transition: transform 0.4s cubic-bezier(.4, 2, .6, 1);
    }

    #footer-settings-btn:hover labs-icon {
      transform: rotate(90deg);
    }
  </style>

  <style>
    #floating-toggles {
      position: fixed;
      top: calc(20px + env(safe-area-inset-top));
      right: calc(20px + env(safe-area-inset-right));
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    #flavorToggle {
      height: 48px;
      width: 48px;
      min-width: 48px;
      min-height: 48px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #flavorIcon {
      width: 28px;
      height: 28px;
    }
  </style>
</head>

<body>
  <!-- Floating theme toggle (top right) -->

  <div id="floating-toggles">
    <labs-button id="flavorToggle" variant="icon" aria-label="Switch flavor" title="Switch flavor">
      <labs-icon id="flavorIcon" slot="icon-left" name="colors"
        style="color:var(--color-on-surface); width:28px; height:28px;"></labs-icon>
    </labs-button>
  </div>


  <labs-footer full-width elevated>
    <div slot="center">
      <labs-button id="footerAddBtn" variant="primary">+ Add</labs-button>
    </div>
    <div slot="right" style="display: flex; align-items: center; gap: 8px;">
      <labs-button id="footer-settings-btn" variant="icon" aria-label="Settings" style="padding-right:12px;">
        <labs-icon name="settings" slot="icon-left" width="28" height="28"></labs-icon>
      </labs-button>
    </div>
  </labs-footer>

  <!-- Settings Overlay -->
  <labs-overlay id="settingsOverlay">
    <labs-settings-card></labs-settings-card>
  </labs-overlay>

  <script type="module">
    import '../design-system/components/labs-overlay.js';
    import '../design-system/components/labs-settings-card.js';
  </script>

  <script>
    // Theme management utilities (mirrored from Pad/Today List)
    function applyTheme({ flavor = 'blueberry', theme = 'light' } = {}) {
      const root = document.documentElement;
      root.classList.remove('flavor-vanilla', 'flavor-blueberry', 'flavor-strawberry');
      root.classList.add(`flavor-${flavor}`);
      root.classList.remove('theme-light', 'theme-dark');
      root.classList.add(`theme-${theme}`);
      root.setAttribute('data-color-scheme', theme);
      localStorage.setItem('today-list-theme', theme);
      localStorage.setItem('today-list-flavor', flavor);
      // Update meta theme-color for PWA
      const themeColorMeta = document.querySelector('meta[name="theme-color"]');
      const bgColor = getComputedStyle(root).getPropertyValue('--color-background').trim();
      if (themeColorMeta && bgColor) {
        themeColorMeta.setAttribute('content', bgColor);
      }
      document.dispatchEvent(new CustomEvent('themeChanged'));
    }

    function initSystemTheme(defaultTheme = 'light') {
      const savedTheme = localStorage.getItem('today-list-theme');
      const savedFlavor = localStorage.getItem('today-list-flavor');
      applyTheme({
        flavor: savedFlavor || 'blueberry',
        theme: savedTheme || 'light',
      });
    }

    function updateThemeToggleButton() {
      const themeIcon = document.getElementById('themeIcon');
      const themeButton = document.getElementById('themeToggle');
      const isDark = document.documentElement.classList.contains('theme-dark');
      if (themeIcon) {
        themeIcon.setAttribute('name', isDark ? 'bedtime_off' : 'bedtime');
      }
      if (themeButton) {
        themeButton.setAttribute('aria-label', isDark ? 'Switch to light mode' : 'Switch to dark mode');
      }
    }

    function toggleTheme() {
      const isDark = document.documentElement.classList.contains('theme-dark');
      const currentFlavor = getCurrentFlavor();
      applyTheme({ flavor: currentFlavor, theme: isDark ? 'light' : 'dark' });
      updateThemeToggleButton();
    }


    function getCurrentFlavor() {
      const flavors = ['vanilla', 'blueberry', 'strawberry'];
      for (const f of flavors) {
        if (document.documentElement.classList.contains(`flavor-${f}`)) return f;
      }
      return 'blueberry';
    }

    function cycleFlavor() {
      const flavors = ['vanilla', 'blueberry', 'strawberry'];
      const current = getCurrentFlavor();
      const idx = flavors.indexOf(current);
      const next = flavors[(idx + 1) % flavors.length];
      const isDark = document.documentElement.classList.contains('theme-dark');
      applyTheme({ flavor: next, theme: isDark ? 'dark' : 'light' });
    }

    // Initialize theme system
    initSystemTheme();

    document.addEventListener('DOMContentLoaded', () => {
      // Setup flavor switcher button
      const flavorToggle = document.getElementById('flavorToggle');
      if (flavorToggle) {
        flavorToggle.addEventListener('click', cycleFlavor);
      }
      // Settings overlay wiring
      const settingsBtn = document.getElementById('footer-settings-btn');
      const settingsOverlay = document.getElementById('settingsOverlay');
      if (settingsBtn && settingsOverlay) {
        settingsBtn.addEventListener('click', () => settingsOverlay.open());
        // Listen for close event from labs-settings-card
        const settingsCard = settingsOverlay.querySelector('labs-settings-card');
        if (settingsCard) {
          settingsCard.addEventListener('close', () => settingsOverlay.close());
        }
      }
    });
  </script>
</body>

</html>
