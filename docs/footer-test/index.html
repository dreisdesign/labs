<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Footer Component Test</title>

    <!-- Design System Tokens -->
    <link rel="stylesheet" href="../design-system/tokens/colors.css">
    <link rel="stylesheet" href="../design-system/tokens/spacing.css">
    <link rel="stylesheet" href="../design-system/tokens/typography.css">
    <link rel="stylesheet" href="../design-system/tokens/border-radius.css">
    <link rel="stylesheet" href="../design-system/tokens/shadows.css">
    <link rel="stylesheet" href="../design-system/styles/flavors.css">

    <!-- Components -->
    <script type="module" src="../design-system/components/labs-container.js"></script>
    <script type="module" src="../design-system/components/labs-footer-with-settings.js"></script>
    <script type="module" src="../design-system/components/labs-template-header.wrapped.js"></script>
    <script type="module" src="../design-system/components/labs-metric-card.js"></script>
    <script type="module" src="../design-system/components/labs-list-item.js"></script>
    <script type="module" src="../design-system/components/labs-checkbox.js"></script>
    <script type="module" src="../design-system/components/labs-dropdown.js"></script>
    <script type="module" src="../design-system/components/labs-icon.js"></script>
    <script type="module" src="../design-system/components/labs-button.js"></script>

    <script type="module">
        // Initialize theme from localStorage or defaults
        import { applyTheme } from '../design-system/utils/theme.js';

        // Restore saved theme/flavor or use defaults
        const savedTheme = localStorage.getItem('tracker-theme') || 'light';
        const savedFlavor = localStorage.getItem('tracker-flavor') || 'blueberry';
        applyTheme({ flavor: savedFlavor, theme: savedTheme });

        // Wire up Add button, theme toggle, and delete all functionality
        window.addEventListener('DOMContentLoaded', () => {
            const footer = document.querySelector('labs-footer-with-settings');
            const container = document.querySelector('labs-container');
            const taskList = document.querySelector('.task-list');
            const metricCard = container.querySelector('labs-metric-card');

            // Update metric count
            function updateCount() {
                const items = taskList.querySelectorAll('labs-list-item');
                const valueSlot = metricCard.querySelector('[slot="value"]');
                if (valueSlot) {
                    valueSlot.textContent = items.length;
                }
            }

            // Add button functionality
            footer.addEventListener('add', () => {
                const newItem = document.createElement('labs-list-item');

                // Create checkbox
                const checkbox = document.createElement('labs-checkbox');
                checkbox.setAttribute('slot', 'control');

                // Create content
                const content = document.createElement('span');
                content.setAttribute('slot', 'content');
                content.textContent = 'New test item';

                // Create dropdown
                const dropdown = document.createElement('labs-dropdown');
                dropdown.setAttribute('slot', 'actions');

                // Assemble item
                newItem.appendChild(checkbox);
                newItem.appendChild(content);
                newItem.appendChild(dropdown);

                // Insert after last list item
                const lastItem = taskList.querySelector('labs-list-item:last-of-type');
                if (lastItem) {
                    lastItem.after(newItem);
                } else {
                    taskList.appendChild(newItem);
                }
                updateCount();
            });

            // Theme toggle - listen for flavor changes from settings card
            footer.addEventListener('flavor-changed', (e) => {
                console.log('Flavor changed to:', e.detail.flavor);
            });

            // Also listen for theme changes on documentElement
            const themeObserver = new MutationObserver(() => {
                const isDark = document.documentElement.classList.contains('theme-dark');
                const flavorClass = [...document.documentElement.classList].find(c => c.startsWith('flavor-'));
                console.log('Theme/Flavor classes updated:', {
                    isDark,
                    flavor: flavorClass
                });
            });
            themeObserver.observe(document.documentElement, {
                attributes: true,
                attributeFilter: ['class']
            });

            // Delete all functionality - listen for reset-all from settings card
            footer.addEventListener('reset-all', () => {
                const items = taskList.querySelectorAll('labs-list-item');
                items.forEach(item => item.remove());
                updateCount();
            });
        });
    </script>

    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--color-background);
            color: var(--color-on-surface);
            font-family: var(--font-family-base);
        }

        labs-container {
            flex: 1;
            display: block;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin-top: var(--space-md);
        }

        /* Remove extra margin from metric card */
        labs-metric-card {
            margin-bottom: var(--space-md);
        }

        /* Ensure no stray elements appear below footer */
        labs-footer-with-settings {
            margin-top: auto;
        }
    </style>
</head>

<body>
    <labs-container padding-md>
        <labs-template-header-wrapped>
            <span slot="title">Footer Test Page</span>
        </labs-template-header-wrapped>

        <labs-metric-card>
            <span slot="label">Test Items</span>
            <span slot="value">3</span>
        </labs-metric-card>

        <div class="task-list">
            <labs-list-item>
                <labs-checkbox slot="control"></labs-checkbox>
                <span slot="content">First test item</span>
                <labs-dropdown slot="actions"></labs-dropdown>
            </labs-list-item>

            <labs-list-item>
                <labs-checkbox slot="control"></labs-checkbox>
                <span slot="content">Second test item</span>
                <labs-dropdown slot="actions"></labs-dropdown>
            </labs-list-item>

            <labs-list-item>
                <labs-checkbox slot="control" checked></labs-checkbox>
                <span slot="content">Third test item</span>
                <labs-dropdown slot="actions"></labs-dropdown>
            </labs-list-item>
        </div>
    </labs-container>

    <labs-footer-with-settings elevated></labs-footer-with-settings>
</body>

</html>