<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Footer Component Test</title>

    <!-- Design System Tokens -->
    <link rel="stylesheet" href="../design-system/tokens/colors.css">
    <link rel="stylesheet" href="../design-system/tokens/spacing.css">
    <link rel="stylesheet" href="../design-system/tokens/typography.css">
    <link rel="stylesheet" href="../design-system/tokens/border-radius.css">
    <link rel="stylesheet" href="../design-system/tokens/shadows.css">
    <link rel="stylesheet" href="../design-system/styles/flavors.css">

    <!-- Components -->
    <script type="module" src="../design-system/components/labs-footer-with-settings.js"></script>
    <script type="module" src="../design-system/components/labs-header.js"></script>
    <script type="module" src="../design-system/components/labs-metric-card.js"></script>
    <script type="module" src="../design-system/components/labs-task-item.js"></script>

    <script type="module">
        // Initialize theme from localStorage or defaults
        import { applyTheme } from '../design-system/utils/theme.js';

        // Restore saved theme/flavor or use defaults
        const savedTheme = localStorage.getItem('tracker-theme') || 'light';
        const savedFlavor = localStorage.getItem('tracker-flavor') || 'blueberry';
        applyTheme({ flavor: savedFlavor, theme: savedTheme });

        // Wire up Add button, theme toggle, and delete all functionality
        window.addEventListener('DOMContentLoaded', () => {
            const footer = document.querySelector('labs-footer-with-settings');
            const container = document.querySelector('.container');
            const metricCard = container.querySelector('labs-metric-card');

            // Update metric count
            function updateCount() {
                const items = container.querySelectorAll('labs-task-item');
                const valueSlot = metricCard.querySelector('[slot="value"]');
                if (valueSlot) {
                    valueSlot.textContent = items.length;
                }
            }

            // Add button functionality
            footer.addEventListener('add', () => {
                const newItem = document.createElement('labs-task-item');
                newItem.textContent = 'New test item';

                // Insert after last task item
                const lastItem = container.querySelector('labs-task-item:last-of-type');
                if (lastItem) {
                    lastItem.after(newItem);
                } else {
                    container.appendChild(newItem);
                }
                updateCount();
            });

            // Theme toggle - listen for flavor changes from settings card
            footer.addEventListener('flavor-changed', (e) => {
                console.log('Flavor changed to:', e.detail.flavor);
            });

            // Also listen for theme changes on documentElement
            const themeObserver = new MutationObserver(() => {
                const isDark = document.documentElement.classList.contains('theme-dark');
                const flavorClass = [...document.documentElement.classList].find(c => c.startsWith('flavor-'));
                console.log('Theme/Flavor classes updated:', {
                    isDark,
                    flavor: flavorClass
                });
            });
            themeObserver.observe(document.documentElement, {
                attributes: true,
                attributeFilter: ['class']
            });

            // Delete all functionality - listen for reset-all from settings card
            footer.addEventListener('reset-all', () => {
                const items = container.querySelectorAll('labs-task-item');
                items.forEach(item => item.remove());
                updateCount();
            });
        });
    </script>

    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--color-surface);
            color: var(--color-on-surface);
            font-family: var(--font-family-base);
        }

        .container {
            flex: 1;
            padding: var(--space-lg);
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        /* Remove extra margin from metric card */
        labs-metric-card {
            margin-bottom: var(--space-md);
        }

        /* Ensure list items are grouped together */
        labs-task-item {
            margin: 0;
        }

        /* Ensure no stray elements appear below footer */
        labs-footer-with-settings {
            margin-top: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <labs-header title="Footer Test Page" center></labs-header>

        <labs-metric-card>
            <span slot="label">Test Items</span>
            <span slot="value">3</span>
        </labs-metric-card>

        <labs-task-item>First test item</labs-task-item>

        <labs-task-item>Second test item</labs-task-item>

        <labs-task-item checked>Third test item</labs-task-item>
    </div>

    <labs-footer-with-settings></labs-footer-with-settings>
</body>

</html>