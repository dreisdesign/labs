<!doctype html>
<html lang="en" class="flavor-blueberry theme-light">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/labs/tracker/favicon.ico" />
    <title>Labs: Tracker Powered by Smoothie</title>
    <!-- Early theme/flavor script moved to after <body> for reliable body access -->

    <link rel="stylesheet" href="/labs/design-system/tokens/colors.css">
    <link rel="stylesheet" href="/labs/design-system/styles/flavors.css">
    <link rel="stylesheet" href="/labs/design-system/styles/main.css">
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            background: var(--color-background);
            color: var(--color-on-surface);
        }

        main {
            flex: 1;
            /* width constrained by outer .container-responsive wrapper */
            padding: 24px;
            box-sizing: border-box;
            background: var(--color-background);
            color: var(--color-on-surface);
        }

        #tracker-root {
            display: grid;
            gap: 16px
        }

        labs-footer {
            flex-shrink: 0;
            width: 100%;
            margin: 0;
            padding: 0 12px;
            box-sizing: border-box;
        }

        #footer-settings-btn labs-icon {
            width: 28px;
            height: 28px;
            transition: transform 0.4s cubic-bezier(.4, 2, .6, 1);
        }

        #footer-settings-btn:hover labs-icon {
            transform: rotate(90deg);
        }

        .footer-center {
            display: flex;
            align-items: center;
            gap: 12px;
        }
    </style>
    <style>
        /* Pre-upgrade CSS: stabilize layout before custom elements upgrade */
        :not(:defined) labs-button[fullwidth],
        :not(:defined) labs-button {
            display: block;
            width: 100%;
        }

        :not(:defined) labs-footer {
            min-height: 40px;
        }
    </style>
    <style>
        /* Prevent the tracker list from collapsing to a very narrow width
           when transitioning between empty and populated states. Keep
           layout responsive but provide a sensible minimum width. */
        #list-root>div {
            box-sizing: border-box;
            width: 100%;
            min-width: 280px;
            max-width: 100%;
        }

        /* Ensure empty message uses full width of the list container */
        #list-root .empty {
            width: 100%;
            box-sizing: border-box;
            padding: 12px 0;
        }

        /* Mobile: add padding to main */
        @media (max-width: 640px) {
            main {
                width: 100%;
                padding: 12px;
            }
        }
    </style>
</head>

<body>
    <!-- Settings overlay -->
    <labs-overlay id="settingsOverlay" size="medium" transparent>
        <labs-settings-card></labs-settings-card>
    </labs-overlay>

    <main id="app" class="container-responsive">
        <section id="tracker-root">
            <!-- metric card -->
            <div id="metric-root"></div>
            <!-- timestamps list -->
            <div id="list-root"></div>
        </section>
    </main>

    <!-- Footer with settings -->
    <labs-footer full-width elevated>

        <div slot="center" class="footer-center">
            <labs-button id="footer-track-btn" size="large" pill variant="primary" fullwidth>
                <labs-icon name="add" slot="icon-left" width="20" height="20"></labs-icon>Track
            </labs-button>
        </div>

        <div slot="right" style="display: flex; align-items: center; gap: 8px;">
            <labs-button id="footer-settings-btn" variant="icon" aria-label="Settings" title="Settings"
                style="margin-right:20px;">
                <labs-icon name="settings" slot="icon-left" width="22" height="22"></labs-icon>
            </labs-button>
        </div>
    </labs-footer>

    <script type="module" src="/labs/design-system/components/labs-icon.js"></script>
    <script type="module" src="/labs/design-system/components/labs-button.js"></script>
    <script type="module" src="/labs/design-system/components/labs-card.js"></script>
    <script type="module" src="/labs/design-system/components/labs-dropdown.js"></script>
    <script type="module" src="/labs/design-system/components/labs-list-item.js"></script>
    <script type="module" src="/labs/design-system/components/labs-footer.js"></script>
    <script type="module" src="/labs/design-system/components/labs-toast.js"></script>
    <script type="module" src="/labs/design-system/components/labs-overlay.js"></script>
    <script type="module" src="/labs/design-system/components/labs-settings-card.js"></script>
    <script type="module" src="/labs/design-system/components/labs-flavor-button.js"></script>

    <!-- Move main.js to the very end for reliable component definition -->
    <script>
        // Early theme/flavor script (tracker, prioritizes tracker-flavor/theme only)
        (function () {
            try {
                var root = document && document.documentElement;
                if (!root) return;
                var flavor = localStorage.getItem('tracker-flavor');
                var theme = localStorage.getItem('tracker-theme');
                // remove any existing flavor- / theme- classes from <html> only
                Array.from(root.classList).forEach(function (c) { if (c && c.indexOf('flavor-') === 0) root.classList.remove(c); });
                Array.from(root.classList).forEach(function (c) { if (c && c.indexOf('theme-') === 0) root.classList.remove(c); });
                if (flavor) root.classList.add('flavor-' + String(flavor));
                else root.classList.add('flavor-blueberry');
                if (theme) root.classList.add('theme-' + String(theme));
                else root.classList.add('theme-light');
            } catch (e) { }
        })();

        document.addEventListener('flavor-changed', function (e) {
            try {
                var fv = (e && e.detail && e.detail.flavor) ? String(e.detail.flavor).replace(/^flavor-/, '') : null;
                if (fv) localStorage.setItem('tracker-flavor', fv);
            } catch (err) { }
        });

        // Observe document.documentElement class changes and persist theme-* and flavor-* class values
        var mo = new MutationObserver(function (mutations) {
            try {
                var root = document.documentElement;
                var themeClass = Array.from(root.classList).find(function (c) { return c && c.indexOf('theme-') === 0; });
                if (themeClass) {
                    var tv = themeClass.replace('theme-', '');
                    localStorage.setItem('tracker-theme', tv);
                }
                var flavorClass = Array.from(root.classList).find(function (c) { return c && c.indexOf('flavor-') === 0; });
                if (flavorClass) {
                    localStorage.setItem('tracker-flavor', flavorClass.replace('flavor-', ''));
                }
            } catch (err) { }
        });
        try {
            mo.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
        } catch (e) { }
    </script>
    </script>


</body>

</html>