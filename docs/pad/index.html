<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Pad â€” Drawing App</title>
  <link rel="icon" type="image/svg+xml" href="../favicon.svg">
  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  <link rel="manifest" href="../manifest.json">

  <script>
    (function () {
      const root = document.documentElement;
      const flavor = localStorage.getItem('pad-flavor') || 'vanilla';
      const theme = localStorage.getItem('pad-theme') || 'light';
      root.classList.remove('flavor-blueberry', 'flavor-strawberry', 'flavor-vanilla');
      root.classList.remove('theme-light', 'theme-dark');
      root.classList.add('flavor-' + flavor);
      root.classList.add('theme-' + theme);
      root.setAttribute('data-color-scheme', theme);
      const themeColorMeta = document.querySelector('meta[name="theme-color"]');
      const bgColor = theme === 'dark' ? '#1B1C1F' : '#FBFBFD';
      if (themeColorMeta) {
        themeColorMeta.setAttribute('content', bgColor);
      }
    })();
  </script>

  <meta name="theme-color" content="#FBFBFD">

  <!-- Design System Tokens -->
  <link rel="stylesheet" href="../design-system/tokens/colors.css">
  <link rel="stylesheet" href="../design-system/tokens/spacing.css">
  <link rel="stylesheet" href="../design-system/tokens/typography.css">
  <link rel="stylesheet" href="../design-system/tokens/border-radius.css">
  <link rel="stylesheet" href="../design-system/tokens/shadows.css">
  <link rel="stylesheet" href="../design-system/styles/flavors.css">

  <!-- Components -->
  <script type="module" src="../design-system/components/labs-container.js"></script>
  <script type="module" src="../design-system/components/labs-template-header.wrapped.js"></script>
  <script type="module" src="../design-system/components/labs-footer-with-settings.js"></script>
  <script type="module" src="../design-system/components/labs-button.js"></script>
  <script type="module" src="../design-system/components/labs-icon.js"></script>

  <!-- Pad App Logic -->
  <script type="module" src="./js/main.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--color-background);
      color: var(--color-on-surface);
      font-family: var(--font-family-base);
      overflow: hidden;
    }

    labs-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Canvas container fills remaining space */
    .pad-canvas-area {
      flex: 1;
      position: relative;
      display: flex;
      overflow: auto;
      border: 1px solid var(--color-outline);
      border-radius: var(--radius-md, 8px);
      margin: var(--space-md);
    }

    #drawingCanvas {
      width: 100%;
      height: 100%;
      display: block;
      cursor: crosshair;
      touch-action: none;
    }

    labs-footer-with-settings {
      flex-shrink: 0;
    }

    /* Safe area support for notched devices */
    @supports (padding: max(0px)) {
      labs-container {
        padding-left: max(0, env(safe-area-inset-left));
        padding-right: max(0, env(safe-area-inset-right));
      }
    }
  </style>
</head>

<body>
  <!-- Main App Container -->
  <labs-container>
    <!-- Header -->
    <labs-template-header-wrapped>
      <span slot="title">Pad</span>
      <span slot="subtitle">Drawing Canvas</span>
    </labs-template-header-wrapped>

    <!-- Canvas Area -->
    <div class="pad-canvas-area">
      <canvas id="drawingCanvas"></canvas>
    </div>
  </labs-container>

  <!-- Footer -->
  <labs-footer-with-settings id="footer"></labs-footer-with-settings>

  <script>
    // Customize the footer Add button to be a Clear All button
    document.addEventListener('DOMContentLoaded', () => {
      const footer = document.getElementById('footer');
      if (footer && footer.shadowRoot) {
        // Wait for shadow DOM to be fully ready
        setTimeout(() => {
          const addBtn = footer.shadowRoot.querySelector('#add-btn');
          if (addBtn) {
            // Update button text
            const btnText = addBtn.querySelector('labs-icon + span') || addBtn.textContent.replace(/add/i, '');
            addBtn.textContent = '';

            // Add icon
            const icon = document.createElement('labs-icon');
            icon.setAttribute('slot', 'icon-left');
            icon.setAttribute('name', 'electric_bolt');
            addBtn.appendChild(icon);

            // Add text
            const text = document.createTextNode('Clear All');
            addBtn.appendChild(text);

            // Update button styling if needed
            addBtn.setAttribute('variant', 'destructive');

            // Listen for the click and show confirmation
            addBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              const confirmed = confirm('Clear the entire canvas? This cannot be undone.');
              if (confirmed) {
                // Dispatch custom event for the drawing app to handle
                document.dispatchEvent(new CustomEvent('pad-clear-all', { bubbles: true }));
              }
            });
          }
        }, 100);
      }
    });
  </script>
</body>

</html>